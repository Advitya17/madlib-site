<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>MADlib: Parallel Latent Dirichlet Allocation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="../mathjax/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">MADlib
   &#160;<span id="projectnumber">0.5</span>
   </div>
   <div id="projectbrief">User Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__grp__plda.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Groups</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Parallel Latent Dirichlet Allocation<div class="ingroups"><a class="el" href="group__grp__unsuplearn.html">Unsupervised Learning</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Collaboration diagram for Parallel Latent Dirichlet Allocation:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<center><table><tr><td><div class="center"><iframe scrolling="no" frameborder="0" src="group__grp__plda.svg" width="395" height="56"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</td></tr></table></center>
</div>
<dl class="section user"><dt>About:</dt><dd></dd></dl>
<p>Latent Dirichlet Allocation (LDA) is an interesting generative probabilistic model for natural texts that has received a lot of attention in recent years. The model is quite versatile, having found uses in problems like automated topic discovery, collaborative filtering, and document classification.</p>
<p>The LDA model posits that each document is associated with a mixture of various topics (e.g. a document is related to Topic 1 with probability 0.7, and Topic 2 with probability 0.3), and that each word in the document is attributable to one of the document's topics. There is a (symmetric) Dirichlet prior with parameter \( \alpha \) on each document's topic mixture. In addition, there is another (symmateric) Dirichlet prior with parameter \( \eta \) on the distribution of words for each topic. The following generative process then defines a distribution over a corpus of documents. First sample, for each topic \( i \), a per-topic word distribution \( \Phi_i \) from the Dirichlet( \(\eta\)) prior. Then for each document:</p>
<ol type="1">
<li>Sample a document length N from a suitable distribution, say, Poisson.</li>
<li>Sample a topic mixture \( \theta \) for the document from the Dirichlet( \(\alpha\)) distribution.</li>
<li>For each of the N words:<ol type="a">
<li>Sample a topic \( z_n \) from the multinomial topic distribution \( \theta \).</li>
<li>Sample a word \( w_n \) from the multinomial word distribution \( \Phi_{z_n} \) associated with topic \( z_n \).</li>
</ol>
</li>
</ol>
<p>In practice, only the words in each document are observable. The topic mixture of each document and the topic for each word in each document are latent unobservable variables that need to be inferred from the observables, and this is the problem people refer to when they talk about the inference problem for LDA. Exact inference is intractable, but several approximate inference algorithms for LDA have been developed. The simple and effective Gibbs sampling algorithm described in Griffiths and Steyvers [2] appears to be the current algorithm of choice. Our parallel implementation of LDA comes from Wang et al [3], which is essentially a straightforward parallelisation of the Gibbs sampling algorithm.</p>
<p>See also <a href="http://code.google.com/p/plda/">http://code.google.com/p/plda/</a>.</p>
<dl class="section user"><dt>Input:</dt><dd>The <b>corpus</b> to be analyzed is expected to be of the following form: <pre>{TABLE|VIEW} <em>datatable</em> (
    <em>id</em> INTEGER,
    <em>contents</em> INTEGER[],
    ...
)</pre> where <code>id</code> refers to the document ID, and <code>contents</code> is an integer array that specifies the words in the document using the index from the dictionary. Words must be represented using positive numbers.</dd></dl>
<p>The <b>dictionary</b> that indexes all the words found in the corpus is of the following form: </p>
<pre>{TABLE|VIEW} <em>dicttable</em> (
    <em>dict</em> TEXT[],
    ...
)</pre><dl class="section user"><dt>Usage:</dt><dd><ul>
<li>Topic inference is achieved through the following UDF <pre>
   SELECT <a class="el" href="plda_8sql__in.html#ac4666953427292c4f3e85d9f5da80238">plda_run</a>('<em>datatable</em>', '<em>dicttable</em>', '<em>modeltable</em>', '<em>outputdatatable</em>', 
            <em>numiter</em>, <em>numtopics</em>, <em>alpha</em>, <em>eta</em>);
   </pre> This function stores the resulting model in <code><em>outputdatatable</em></code>.</li>
<li>Labelling of test documents using a learned LDA model is achieved using the following UDF <pre>
   SELECT <a class="el" href="plda_8sql__in.html#adefc4576799e950baf03e7ba66c34eba">plda_label_test_documents</a>('<em>testtable</em>', '<em>outputtable</em>', '<em>modeltable</em>', '<em>dicttable</em>',
                             <em>numtopics</em>, <em>alpha</em>, <em>eta</em>);
   </pre> This creates the following table with the assigned topic for each word in the test corpus. <pre>
    id |           contents            |              topics               
   ----+-------------------------------+-----------------------------------
   ...
   </pre></li>
</ul>
</dd></dl>
<dl class="section user"><dt>Implementation Notes:</dt><dd>The input format for the Parallel LDA module is different from that used by the lda package for R. In the lda package, each document is represented by two equal dimensional integer arrays. The first array represents the words that occur in the document, and the second array captures the number of times each word in the first array occurs in the document. This representation appears to have a major weakness in that all the occurrences of a word in a document must be assigned the same topic, which is clearly not satisfactory. Further, at the time of writing, the main learning function in the lda package actually does not work correctly when the occurrence counts for words aren't one.</dd></dl>
<p>There is a script called generateTestCases.cc that can be used to generate some simple test documents to validate the correctness and effiency of the parallel LDA implementation.</p>
<dl class="section user"><dt>Examples:</dt><dd></dd></dl>
<p>We now give a usage example.</p>
<ol type="1">
<li>As a first step, we need to prepare a corpus and dictionary in the appropriate structure. <div class="fragment"><div class="line">sql&gt; CREATE TABLE MADlib.plda_mydict ( dict text[] ) DISTRIBUTED RANDOMLY;</div>
<div class="line">sql&gt; INSERT into MADlib.plda_mydict values</div>
<div class="line"> (<span class="stringliteral">&#39;{human,machine,interface,for,abc,computer,applications,a,survey,of,</span></div>
<div class="line"><span class="stringliteral">   user,opinion,system,response,time,the,eps,management,and,engineering,</span></div>
<div class="line"><span class="stringliteral">   testing,relation,perceived,to,error,generation,random,binary,order,tree,</span></div>
<div class="line"><span class="stringliteral">   intersection,graph,path,in,minor,IV,widths,well,quasi}&#39;</span>);</div>
<div class="line"></div>
<div class="line">sql&gt; CREATE TABLE MADlib.plda_mycorpus ( <span class="keywordtype">id</span> int4, contents int4[] );</div>
<div class="line">sql&gt; INSERT INTO MADlib.plda_mycorpus VALUES </div>
<div class="line"> (1, <span class="stringliteral">&#39;{1,2,3,4,5,6,7}&#39;</span>), </div>
<div class="line"> (2, <span class="stringliteral">&#39;{8,9,10,11,12,10,6,13,14,15}&#39;</span>),</div>
<div class="line"> (3, <span class="stringliteral">&#39;{16,17,11,3,18,13}&#39;</span>),</div>
<div class="line"> (4, <span class="stringliteral">&#39;{13,19,1,13,20,21,10,17}&#39;</span>),</div>
<div class="line"> (5, <span class="stringliteral">&#39;{22,10,11,23,14,15,24,25,18}&#39;</span>),</div>
<div class="line"> (6, <span class="stringliteral">&#39;{16,26,10,27,28,29,30}&#39;</span>),</div>
<div class="line"> (7, <span class="stringliteral">&#39;{16,31,32,10,33,34,30}&#39;</span>),</div>
<div class="line"> (8, <span class="stringliteral">&#39;{32,35,36,37,10,30,19,38,39,29}&#39;</span>),</div>
<div class="line"> (9, <span class="stringliteral">&#39;{32,35,8,9}&#39;</span>) ;</div>
</div><!-- fragment --></li>
<li>To perform inference, we call the <a class="el" href="plda_8sql__in.html#ac4666953427292c4f3e85d9f5da80238" title="Main plda function. ">plda_run()</a> function with the appropriate parameters. Here is an example. <div class="fragment"><div class="line">sql&gt; select MADlib.plda_run(<span class="stringliteral">&#39;MADlib.plda_mycorpus&#39;</span>, <span class="stringliteral">&#39;MADlib.plda_mydict&#39;</span>, </div>
<div class="line">                  <span class="stringliteral">&#39;MADlib.plda_mymodel&#39;</span>, <span class="stringliteral">&#39;MADlib.plda_corpus&#39;</span>, </div>
<div class="line">             30,10,0.5,0.5);</div>
</div><!-- fragment --> After a successful run of the <a class="el" href="plda_8sql__in.html#ac4666953427292c4f3e85d9f5da80238" title="Main plda function. ">plda_run()</a> function, the most probable words associated with each topic are displayed. Other results of the learning process can be obtained by running the following commands. Here we assume the modeltable and outputdatatable parameters to <a class="el" href="plda_8sql__in.html#ac4666953427292c4f3e85d9f5da80238" title="Main plda function. ">plda_run()</a> are 'MADlib.plda_mymodel' and 'MADlib.plda_corpus' respectively.<ol type="a">
<li>The topic assignments for each document can be obtained as follows: <div class="fragment"><div class="line">sql&gt; select id, (topics).topics from MADlib.plda_corpus;</div>
</div><!-- fragment --></li>
<li>The topic distribution of each document can be obtained as follows: <div class="fragment"><div class="line">sql&gt; select id, (topics).topic_d from MADlib.plda_corpus;</div>
</div><!-- fragment --></li>
<li>The number of times each word was assigned to a given topic in the whole corpus can be computed as follows: <div class="fragment"><div class="line">sql&gt; select ss.i, MADlib.plda_word_topic_distrn(gcounts,$numtopics,ss.i) </div>
<div class="line">from MADlib.plda_mymodel, </div>
<div class="line">     (select generate_series(1,$dictsize) i) as ss;</div>
</div><!-- fragment --> where $numtopics is the number of topics used in the learning process, and $dictsize is the size of the dictionary.</li>
<li>The total number of words assigned to each topic in the whole corpus can be computed as follows: <div class="fragment"><div class="line">sql&gt; select sum((topics).topic_d) topic_sums from MADlib.plda_corpus;</div>
</div><!-- fragment --></li>
</ol>
</li>
<li>To use a learned LDA model to label new documents, we can use the following commands: <div class="fragment"><div class="line">sql&gt; select MADlib.plda_label_test_documents(<span class="stringliteral">&#39;MADlib.plda_mycorpus&#39;</span>, <span class="stringliteral">&#39;MADlib.plda_testresult&#39;</span>, <span class="stringliteral">&#39;MADlib.plda_mymodel&#39;</span>, <span class="stringliteral">&#39;MADlib.plda_mydict&#39;</span>, 10,0.5,0.5);</div>
<div class="line">sql&gt; select * from MADlib.plda_testresult;</div>
</div><!-- fragment --></li>
</ol>
<dl class="section user"><dt>Literature:</dt><dd></dd></dl>
<p>[1] D.M. Blei, A.Y. Ng, M.I. Jordan, <em>Latent Dirichlet Allocation</em>, Journal of Machine Learning Research, vol. 3, pp. 993-1022, 2003.</p>
<p>[2] T. Griffiths and M. Steyvers, <em>Finding scientific topics</em>, PNAS, vol. 101, pp. 5228-5235, 2004.</p>
<p>[3] Y. Wang, H. Bai, M. Stanton, W-Y. Chen, and E.Y. Chang, <em>PLDA: Parallel Dirichlet Allocation for Large-scale Applications</em>, AAIM, 2009.</p>
<p>[4] <a href="http://en.wikipedia.org/wiki/Latent_Dirichlet_allocation">http://en.wikipedia.org/wiki/Latent_Dirichlet_allocation</a></p>
<p>[5] J. Chang, Collapsed Gibbs sampling methods for topic models, R manual, 2010.</p>
<dl class="section see"><dt>See Also</dt><dd>File <a class="el" href="plda_8sql__in.html" title="SQL functions for parallel Latent Dirichlet Allocation. ">plda.sql_in</a> documenting the SQL functions. </dd></dl>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Sep 10 2013 13:36:19 for MADlib by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.4 </li>
  </ul>
</div>
</body>
</html>
